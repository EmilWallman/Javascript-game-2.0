<!DOCTYPE html>
<html lang="en">
<head>
 
    <script src = "spel-programmering-template/simple.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Game</title>
 
</head>
<body>
    
    <progress id="health" value="100" max="100"></progress>
    <style>
        

    
        body{ background-color: lightblue};    
        progress::-moz-progress-bar{background: green;}
        progress{background: green;
            width: 30em;
            height: 2em;
        }
        
        

    
    </style>

    <script>
        //enemies
        let enemyend = false
        let enemyspeed = 1;
        let enemy = [];
        //Getting health info
        let health = document.getElementById("health")
        health.value = 100;

        //For the bullets
        let activeBullet = false;
        let bulletx = 0;
        let bullety = 0;    

        let bullets = [];
        let bulletsspeed = 15

        //player cords
        var p1 = {x: 100, y: 360, speed: 10}
        
        
        //Clouds in the end and beginning of the canvas
        

        //sound
        

        

       
        

        preloadSound("sound/Bulletsound.mp3");


        let song = new Audio ("sound/bb.mp3")
        
        function getRnd(min, max){
            return Math.floor(Math.random()* (max - min + 1) ) + min;
        }
        song.play();


        function arraymove (arr, from, to){
            var element = arr[from];
            arr.splice(from, 1);
            arr.splice(to, 0, element);
        }
        function update()
        {
                
            clearScreen();
            
            
            for(let i = 0; i < 5; i++){
                let rndy = getRnd(20, window.innerHeight-20);
                let rndx = getRnd(window.innerWidth, window.innerWidth + 800);        
                
                enemy.push([rndx, rndy]);

                circle(enemy[i][0], enemy[i][1], 40, "red")
                if (enemy[i][0] > -11){
                    enemy[i][0] -= enemyspeed;
                    

                    if(enemy[i][0] < 0){
                        enemyend = true;
                        arraymove(enemy, i, 1);
                    }
                }  
            }
            
                
            if (enemyend == true){
                health.value -= 10;
                enemy.shift();
                enemyend = false;
            }
            

            

            /*
            for(let i = 0; i < bullets1.length; i++){
                for(let j = 0; j < enemy.length; j++){ 
                    let distans = distance(bullets1[i][0], bullets1[i][1], enemy[j][0] + 20, enemy[j][1] + 20);
                    if (distans < 40){
                        arraymove(bullets1, i, 1);
                        arraymove(enemy, j, 0);
                        enemy.shift();
                        bullets1.shift(1);
                        
                        
                    }
                }
            }
            */  
            
            //Some controls for the plane and the plane picture
            
            picture(p1.x, p1.y, "bilder/Plane 1.png")
            if (keyboard.w){
                p1.y -= p1.speed

            }
            if (keyboard.s){p1.y += p1.speed}
            if (keyboard.a){p1.x -= p1.speed}
            if (keyboard.d){p1.x += p1.speed}
            
            //Bullets
            if (keyboard.space){
                activeBullet = true;
                bulletx = p1.x +58;
                bullety = p1.y +48;

                bullets.push([bulletx, bullety]);
               
            }

            if(activeBullet == true){
                
                for(let i = 0; i < bullets.length; i++){
                    bullets[i][0]+= bulletsspeed;
                    bullets[i][1]+=0;
                    circle(bullets[i][0] , bullets[i][1] , 2, "black");
                    
                    
                    
                    /*
                    if (bullets1[i][0] > window.innerWidth){
                        arraymove(bullets1, i, 1);
                        bullets1.shift(1);
                    }*/
                }
            }

            

            //Enemies
            
            
            
            



            //ending
            if (health.value <= 0){
                alert("Game Over!")
                
                
            }
        }


    </script>
    

</body>
</html>